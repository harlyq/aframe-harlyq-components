<!DOCTYPE html>
<html>
  <head>
    <title>SVG UI Examples</title>
    <!--script src="https://aframe.io/releases/0.9.1/aframe.js"></script-->
    <script src="../../aframe/aframe-0.9.0.js"></script>
    <script src="../dist/aframe-harlyq-components.js"></script>
    <script id="ui_template" type="x-template">
      <svg id="svg1" viewBox="0 0 120 240" xmlns="http://www.w3.org/2000/svg" version="1.1">
        <g id="two">
          <circle id="circle1" cx="50" cy="50" r="30" cursor="move" fill="${_col}"/>
        </g>
      </svg>
    </script>
    <script id="ui_custom" type="x-template">
      <svg id="svg2" viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg" version="1.1">
        <rect x="0" y="0" width="120" height="120" stroke="cyan"/>
        ${_boxes.split(",").map(box => box.trim()).map( (box,i) => {
          const delta = (box==_hover ? 2 : 0)
          const xPos = 80 - delta
          const w = 20 + 2*delta
          const yPos = 18+30*i
          const h = 20 + 2*delta
          return `
            <text x="20" y="${yPos+15}" fill="cyan">check ${box}</text>
            <rect id="${box}" x="${xPos}" y="${yPos - delta}" width="${w}" height="${h}" stroke="cyan" fill="${box==_checked ? 'teal' : 'black'}" />
          `
        }).join("")}
        <text x="2" y="115" fill="cyan">${_time}</text>
      </svg>
    </script>
  </head>
  <body>
    <a-scene id="scene" background2="color: grey" store__a="type: session; _checked: A">
      <a-entity laser-controls="hand: right" raycaster="objects: [svg-ui]; far: 20" line="color: cyan; opacity: 0.75"></a-entity>
      <a-plane position="0 2 -5" 
        material="transparent: true;" 
        svg-ui="template: #ui_template; clickSelectors: g; _col: purple"
      ></a-plane>
      <a-entity id="counter" position="0 0 -10" 
        material="transparent: false; color: white; side: back"
        geometry="primitive: sphere; radius: 8; phiStart: -180; phiLength: 180; thetaStart: 40; thetaLength: 100"
        svg-ui="template: #ui_custom; clickSelectors: rect; hoverSelectors: rect[id]; bubbles: true; _boxes: A,B,C; _checked:; _hover:; _time: 0;"
        uv-transform="repeat: -1 1"
        store-bind__1="store: #scene; from: store__a._checked; to: svg-ui._checked"
        wait-set__1="event: svg-ui-click; target: a-scene; store__a._checked: $event.detail.uiTarget.id"
        wait-set__2="event: test-tick; svg-ui._time: $event.detail.count;"
        wait-set__3="event: svg-ui-hoverenter; svg-ui._hover: $event.detail.uiTarget.id;"
        wait-set__4="event: svg-ui-hoverleave; svg-ui._hover: none"
      ></a-entity>
      <a-plane position="2 2 -5" material="transparent: true" svg-ui="template: url(animated-square.svg); _col: orange;" texture-updater></a-plane>
      <a-plane position="0 0 -5" material="transparent: true" svg-ui='_col: #245; template: <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" version="1.1"><rect x="5" y="5" width="80" height="60" rx="5" fill="${_col}"/></svg>;'></a-plane>
    </a-scene>
    <script>
      const counterEl = document.getElementById("counter")
      if (counterEl) {
        setInterval(mark, 5) // more often than the animationFrame
      }
      
      function mark() {
        counterEl.emit("test-tick", {count: Date.now()}) // use a tick because setAttribute() doesn't like components with kebab-case
      }
    </script>
  </body>
</html>